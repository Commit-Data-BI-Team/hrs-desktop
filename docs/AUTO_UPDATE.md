# Auto Update Setup (Windows + macOS)

## What is implemented

- In-app update controls in Settings and Tray Settings:
  - `Check now`
  - `Download`
  - `Restart & install`
- Main process updater events are pushed to renderer via IPC (`app:updateState`).
- Automatic background check every 6 hours (packaged builds only).

## Feed configuration

The app updater requires a feed source that serves Electron Builder metadata and artifacts.

You have two options:

1. `HRS_UPDATE_FEED_URL` env var (recommended first)
2. `app-update.yml` shipped in packaged app resources

If neither exists, updater is shown as disabled.

### Expected feed contents

For each release channel, host files generated by `electron-builder`:

- Windows: `latest.yml`, installer (`.exe`), blockmap files
- macOS: `latest-mac.yml`, `.zip`/`.dmg`, blockmap files

## Local build usage

```bash
npm install
HRS_UPDATE_FEED_URL="https://your-domain.com/hrs-updates" npm run dist:win
HRS_UPDATE_FEED_URL="https://your-domain.com/hrs-updates" npm run dist:mac
```

## Signing requirements (production)

### Windows

- Sign NSIS installer and app binary with Authenticode cert.
- Use CI env vars:
  - `CSC_LINK`
  - `CSC_KEY_PASSWORD`

### macOS

- Sign with Developer ID Application.
- Notarize release.
- Use CI env vars:
  - `APPLE_ID`
  - `APPLE_APP_SPECIFIC_PASSWORD`
  - `APPLE_TEAM_ID`

Unsigned builds may update unreliably or be blocked by OS trust policies.

## Important notes

- `portable.exe` is not a good target for auto-update workflow. Prefer NSIS installation.
- Auto-update logic is disabled in dev mode (`app.isPackaged === false`).
